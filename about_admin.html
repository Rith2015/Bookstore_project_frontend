<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inkspire Library</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <button class="btn btn-outline-light me-3" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu"
                aria-controls="offcanvasMenu">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="mx-auto text">
                <h1 class="navbar-brand">Inkspire Library</h1>
            </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse ms-auto" id="navbarSupportedContent">
                <form class="d-flex ms-auto" id="search-form">
                    <input class="form-control me-2" type="search" placeholder="Search books or authors" aria-label="Search"
                        id="search">
                    <input class="form-control me-2" type="search" placeholder="Search customers" aria-label="Search"
                        id="search_customer">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                </form>

                <!-- Login Button -->
                <button class="btn btn-outline-light ms-3" data-bs-toggle="modal" data-bs-target="#loginModal">Admin Log
                    In</button>
                    <button class="btn btn-outline-light ms-3" data-bs-toggle="modal" data-bs-target="#registerModal">Register new admin user</button>
                    <button class="btn btn-outline-light ms-3"><a href="index.html">Log out</a></button>
                </div>
        </div>
    </nav>

    <!-- Login Modal (Popup) -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Log In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" placeholder="Enter your username">
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="text" class="form-control" id="password" placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn btn-primary" onclick="login()">Log In</button>
                </div>
            </div>
        </div>
    </div>
<!-- Registration Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">Register</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="registerUsername" class="form-label">Username</label>
                    <input type="text" class="form-control" id="registerUsername" placeholder="Choose a username">
                </div>
                <div class="mb-3">
                    <label for="registerPassword" class="form-label">Password</label>
                    <input type="text" class="form-control" id="registerPassword" placeholder="Choose a password">
                </div>
                <button type="submit" class="btn btn-success" onclick="register()">Register</button>
            </div>
        </div>
    </div>
</div>
     <!-- Off-Canvas Menu -->
     <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasMenuLabel">Library Sections</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="admin.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="books_data.html">Books Data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="customers_data.html">Customers Data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="loans_data.html">Loans Data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="about_admin.html">About</a>
                </li><br>
                <li class="nav-item">
                    <button class="btn btn-success mb-2" onclick="seed_data()">Reset data tables</button>
                    <button class="btn btn-danger mb-2" onclick="delete_tables()">Delete data tables</button>
                </li>
            </ul>
        </div>
    </div>
    <div id="display" class="text-white" style="background-color: black; margin: 10px; padding: 20px;">
        <h1 class="text-center">Admin Side of Inkspire Library</h1>
        <p class="text-center">The admin side of Inkspire Library is designed to provide administrators with powerful tools for managing library resources, users, and transactions. This section of the platform offers various functionalities that streamline the management of books, customers, and loans, ensuring a smooth operation of the library.</p>
        
        <h2 class="mt-4">Admin Overview</h2>
        <p>The admin interface is built with HTML and styled with Bootstrap, providing a responsive and intuitive design. It includes essential features for effective management, such as user registration, book management, and loan tracking. In every admin page there a log out button to return to the client side of the library.</p>
        
        <h2 class="mt-4">Pages and Features:</h2>
        <div class="card mb-2">
            <div class="card-header">
        <h3>navbar and offcanvas - In every page</h3>
    </div>
    <div class="card-body">
        <p>The navbar and offcanvas is in every page. The navbar lets the admin users search for books or customer, and also log in as admin or log out to return to the client side of the library. Users can also register new admin users. The nav bar system has the following elements:</p>
        <ul>
            <li><strong>Search Bar:</strong> Easily search for books by title or author.</li>
            <li><strong>Navigation Bar:</strong> Provides access to all sections of the site.</li>
            <li><strong>Admin Login:</strong> Allows administrators to securely log in through a modal.</li>
            <li><strong>Admin Log out:</strong> Allows administrators to log out to return to client side of the site.</li>
            <li><strong>Admin Register:</strong> Allows administrators to create new admin users.</li>
        </ul>
        <p>The offcanvas lets admin users swithc between every page, and has a restet table button that reset the data of books,customers and loans. The offcanvas system has the following elements:</p>
        <ul>
            <li><strong>Switch pages:</strong>Click on a button on the offcanvas to head into that html page.</li>
            <li><strong>Reset data tables:</strong>Create all tables and Seed the tables with data from the backend.</li>
            <li><strong>Delete data tables:</strong>Deletes all tables in the database.</li>
        </ul>
    </div>
</div>
        <div class="card mb-2">
            <div class="card-header">
                <h3>admin.html - Administration Dashboard</h3>
            </div>
            <div class="card-body">
                <p>The administration dashboard serves as the central hub for all administrative activities:</p>
                <ul>
                    <li><strong>Navigation Menu:</strong> Easily access different sections like books, customers, and loans.</li>
                    <li><strong>Library Statistics:</strong> Provides an overview of key metrics such as total books and active loans.</li>
                    <li><strong>Search Functionality:</strong> Quickly find customers or books within the library.</li>
                    <li><strong>Admin User Registration:</strong> Allows for the addition of new admin users through a dedicated registration feature.</li>
                </ul>
            </div>
        </div>
    
        <div class="card mb-2">
            <div class="card-header">
                <h3>books_data.html - Manage Book Collection</h3>
            </div>
            <div class="card-body">
                <p>This page provides tools for managing the library's book collection effectively:</p>
                <ul>
                    <li><strong>Add New Books:</strong> A form to enter details for new books, including title, author, and genre.</li>
                    <li><strong>Edit Existing Records:</strong> Modify details of current book entries directly in the table.</li>
                    <li><strong>Dynamic Book Table:</strong> View all books in an organized table format, with options to delete or view details.</li>
                </ul>
            </div>
        </div>
    
        <div class="card mb-2">
            <div class="card-header">
                <h3>customers_data.html - Manage Customer Records</h3>
            </div>
            <div class="card-body">
                <p>This page allows for efficient management of customer records:</p>
                <ul>
                    <li><strong>Add New Customers:</strong> A form to input customer details, including name and contact information.</li>
                    <li><strong>Editable Customer Information:</strong> Update existing customer records as needed.</li>
                    <li><strong>Customer List:</strong> Displays all customers with options to delete or edit records.</li>
                </ul>
            </div>
        </div>
    
        <div class="card mb-2">
            <div class="card-header">
                <h3>loans_data.html - Manage Loan Transactions</h3>
            </div>
            <div class="card-body">
                <p>This page facilitates the management of loan transactions:</p>
                <ul>
                    <li><strong>Overview of All Loans:</strong> View a comprehensive list of current and overdue loans.</li>
                    <li><strong>Update Loan Information:</strong> Modify details of loans, such as return dates and statuses.</li>
                    <li><strong>Filter Options:</strong> View specific loans, such as overdue loans.</li>
                </ul>
            </div>
        </div>
    </div>


    <script>
        const SERVER = "https://bookstore-project-backend-io1x.onrender.com";
        // log in admin username and password to get token
        const login = async () => {
            try {
                const res = await axios.post(`${SERVER}/login`, {
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                });
                localStorage.setItem("access_token", res.data.access_token);
                window.location.href = "admin.html";
            } catch (error) {
                console.error(error);
                alert("Wrong username or password!");
            }
        }
        // create new admin username
        const register = async () => {
        try {
            const res = await axios.post(`${SERVER}/register`, {
                username: document.getElementById('registerUsername').value,
                password: document.getElementById('registerPassword').value
            });
            localStorage.setItem("access_token", res.data.access_token);
            window.location.href = "admin.html"; // Redirect to admin page on success
        } catch (error) {
            console.error(error);
            alert(error.response?.data?.message || "Registration failed! Please try again.");
        }
    };
        // search for books or authors or customers by name
        const search = async (event) => {
            event.preventDefault(); // Prevent the form from submitting and refreshing the page
            const bookName = document.getElementById('search').value;
            const customerName = document.getElementById('search_customer').value
            if (bookName) {
                const booksResponse = await axios(`${SERVER}/search_books/${bookName}`);// Search for books names
                const authorResponse = await axios(`${SERVER}/search_author/${bookName}`);// Search for books authors
                const books = [...booksResponse.data, ...authorResponse.data]; // Combine results
                if (books.length === 0) {
                    alert("No books or authors with this name found!"); // Alert the user if no book is found
                    return;
                }
                display.innerHTML = books.map(item => `
            <div class="card" style="width: 15%;">
                <img src="${item.image_url}" class="card-img-top" alt="Book image">
                <div class="card-body">
                    <h5 class="card-title">${item.name} by ${item.author}</h5>
                    <p class="card-text">Category: ${item.category}, Year: ${item.year_published}<br>
                    You can loan this book ${item.duration}.<br>
                    <h6>Currently: ${item.status}.</h6></p>
                    <a href="loans_data.html" class="btn btn-primary">Loan</a>
                </div>
            </div>
        `).join("");// Search for customers
            } else if (customerName) try {
                token = localStorage.getItem("access_token")
                const response = await axios.get(`${SERVER}/search_customer/${customerName}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                const customers = response.data;
                if (customers.length === 0) {
                    alert("No customers found!"); // Alert the user if no customer is found
                    return;
                } display.innerHTML = customers.map(item => `
            <div class="card" style="width: 15%;">
                <div class="card-body">
                    <h5 class="card-title">${item.name}, Age: ${item.age}</h5>
                    <p class="card-text">Email: ${item.email}</p>
                    <p class="card-text">Number: ${item.phone_number}</p>
                    <p class="card-text">City: ${item.city}</p>
                </div>
            </div>
        `).join("");
            }catch {
                alert("Please admin log in.");
            }
            else { alert("Please enter a search query."); }
        };
        // Attach the search event to the form
        document.getElementById('search-form').addEventListener('submit', search);
        // delete data tables  
        const delete_tables = async () => {
            const token = localStorage.getItem("access_token");
            try{
            const response = await axios.delete(`${SERVER}/delete_tables`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            alert(response.data.message)
        }catch (error) {
                console.error(error);
                alert('Failed to delete tables please admin log in!');
            }
        }
        // create all tables and Seed the tables with data from the backend
        const seed_data = async () => {
            try{
                const response = await axios.post(`${SERVER}/seed_data`)
                alert(response.data.message);
            }catch (error) {
                console.error(error);
                alert('Failed to seed data please admin log in!');
            }
        }
    </script>
</body>

</html>